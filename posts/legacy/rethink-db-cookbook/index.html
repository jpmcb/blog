<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Rethink-DB Cookbook | John McBride</title>
<meta name=keywords content><meta name=description content="(Note: this is from an old blog archieve dating 2018/11/05. Some things with Rethink have very likely changed)
RethinkDB is a JSON based, non-relational database that provides a promise oriented, Node JS backend. It integrates seamlessly with JSON type data  and is a production ready option for Node infrastructures.
Pre-reqs: Docker, Node, NPM
This post will serve as a brief overview of RethinkDB and hopefully give you a taste of how it works and why a JSON based database might be beneficial for you and your product. You should have some knowledge of docker for this tutorial, but it&rsquo;s not required. However, knowledge of Node and JavaScript will be necessary."><meta name=author content><link rel=canonical href=https://johncodes.com/posts/legacy/rethink-db-cookbook/><link crossorigin=anonymous href=/assets/css/stylesheet.9329d037bc79464b26647fb72e079cd738f5d2418b1df4da3b515db9e22cb4d9.css integrity="sha256-kynQN7x5RksmZH+3Lgec1zj10kGLHfTaO1FdueIstNk=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://johncodes.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://johncodes.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://johncodes.com/favicon-32x32.png><link rel=apple-touch-icon href=https://johncodes.com/apple-touch-icon.png><link rel=mask-icon href=https://johncodes.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://johncodes.com/posts/legacy/rethink-db-cookbook/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="Rethink-DB Cookbook"><meta property="og:description" content="(Note: this is from an old blog archieve dating 2018/11/05. Some things with Rethink have very likely changed)
RethinkDB is a JSON based, non-relational database that provides a promise oriented, Node JS backend. It integrates seamlessly with JSON type data  and is a production ready option for Node infrastructures.
Pre-reqs: Docker, Node, NPM
This post will serve as a brief overview of RethinkDB and hopefully give you a taste of how it works and why a JSON based database might be beneficial for you and your product. You should have some knowledge of docker for this tutorial, but it&rsquo;s not required. However, knowledge of Node and JavaScript will be necessary."><meta property="og:type" content="article"><meta property="og:url" content="https://johncodes.com/posts/legacy/rethink-db-cookbook/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-11-05T21:15:35-07:00"><meta property="article:modified_time" content="2018-11-05T21:15:35-07:00"><meta property="og:site_name" content="John-McBride"><meta name=twitter:card content="summary"><meta name=twitter:title content="Rethink-DB Cookbook"><meta name=twitter:description content="(Note: this is from an old blog archieve dating 2018/11/05. Some things with Rethink have very likely changed)
RethinkDB is a JSON based, non-relational database that provides a promise oriented, Node JS backend. It integrates seamlessly with JSON type data  and is a production ready option for Node infrastructures.
Pre-reqs: Docker, Node, NPM
This post will serve as a brief overview of RethinkDB and hopefully give you a taste of how it works and why a JSON based database might be beneficial for you and your product. You should have some knowledge of docker for this tutorial, but it&rsquo;s not required. However, knowledge of Node and JavaScript will be necessary."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://johncodes.com/posts/"},{"@type":"ListItem","position":2,"name":"Rethink-DB Cookbook","item":"https://johncodes.com/posts/legacy/rethink-db-cookbook/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Rethink-DB Cookbook","name":"Rethink-DB Cookbook","description":"(Note: this is from an old blog archieve dating 2018/11/05. Some things with Rethink have very likely changed) RethinkDB is a JSON based, non-relational database that provides a promise oriented, Node JS backend. It integrates seamlessly with JSON type data and is a production ready option for Node infrastructures.\nPre-reqs: Docker, Node, NPM\nThis post will serve as a brief overview of RethinkDB and hopefully give you a taste of how it works and why a JSON based database might be beneficial for you and your product. You should have some knowledge of docker for this tutorial, but it\u0026rsquo;s not required. However, knowledge of Node and JavaScript will be necessary.\n","keywords":[],"articleBody":"(Note: this is from an old blog archieve dating 2018/11/05. Some things with Rethink have very likely changed) RethinkDB is a JSON based, non-relational database that provides a promise oriented, Node JS backend. It integrates seamlessly with JSON type data and is a production ready option for Node infrastructures.\nPre-reqs: Docker, Node, NPM\nThis post will serve as a brief overview of RethinkDB and hopefully give you a taste of how it works and why a JSON based database might be beneficial for you and your product. You should have some knowledge of docker for this tutorial, but it’s not required. However, knowledge of Node and JavaScript will be necessary.\nRun the offical Docker Image You can pull and run the official rethink docker image to start the database locally. Simply give it a name and you’re on your way!\ndocker run -d -P --name rethinkdb To check the port mappings in docker, simply run\ndocker port This will show you something like this:\n28015/tcp -\u003e 0.0.0.0:32769 29015/tcp -\u003e 0.0.0.0:32768 8080/tcp -\u003e 0.0.0.0:32770 Each of the local port mappings appear on the right and the docker container exposed ports are on the left.\nSo, if you wanted to access the containers 8080 port, we would navigate to localhost:32770. We can see this from the example as 8080/tcp -\u003e 0.0.0.0:32770.\nAlternatively, you can install rethinkdb for your specific machine and run it locally. This can be found on the RethinkDB install page. Using the docker container \u0026 image is a nice, light weight, modular way to run rethink, similar to how a production microservice architecture might be configured. I also like being able to control the exact environment that my rethink database is running in, it’s ports, and other fun docker quality of life things!\nUsing the RethinkDB admin pannel If using the docker container, navigate to the Admin Panel by going to localhost:32770 in a browser. From our previous example, we can see that this local port is mapped to the docker container port 8080 (which is the web admin panel). If you’re running rethink on your machine locally, you should be able to simply navigate to localhost:8080.\nIn the admin pannel, you create new databases, explor data, see logs, track performance, and see what connections are running. Lets create a database with a few tables.\nIn the top navigation bar, go to the “Data Explorer” and enter the following:\nr.dbCreate('ships') r.db('ships').tableCreate('battle_ships') r.db('ships').tableCreate('cruisers') These raw rethink queries create and build our initial database. This can also be acomplished from “Tables” in the top navigation bar or right in your node app! However, the “Data Explorer” is an essential tool for viewing, manuipulating, and creating data. This is a great link for useful Data Explorer queries.\nInstall Rethink javascript drivers via NPM In order to use the rethink drivers in our Node app, we need to install them via NPM. From the command line:\nnpm install rethinkdb The node_modules folder will now contain the necessary rethink drivers for accessing our rethink instance. To access the rethink drivers from your Node app, require the drivers:\nconst r = require('rethinkdb'); Open a connection to the Rethink instance let connection = null; // This could also be declared from a .env file let config = { host: 'localhost', port: '32769' } r.connect(config, function(err, conn) { if (err) throw err; connection = conn; }); Now, the connection variable will hold the raw data necessary to connect to the rethink instance. Make special note of what port you specify. This should be the port that maps to 28015 in the docker container.\nFor this local instance of the rethinkdb, we won’t worry too much about dynamic ports or not exposing the ports to the public in production. Here is a good article about one way you can create production ready ports and configurations.\nThis step can be quite complicated. You can do a number of things per your needs, including placing this step into some middleware to connect automatically, check the configuration of your database, reconfigure settings if something is wrong, or validate authorization. Check out this repository from the rethink people for more complex operations around connecting.\nBasic Crud Operations Insert Data // Inserts 2 battleships r.db('ships').table('battle_ships').insert([ { 'name': 'Arizona', 'size': 22, 'guns': [ 'railgun', 'off_shore_missles' ] }, { 'name': 'Iowa', 'size': 34, 'guns': [ 'light_machine' ] }]).run(connection, function (err, res) { if (err) throw err; console.log(JSON.stringify(res)); }) We can see that we are inserting raw JSON objects! Awesome! Now, from the Data explorer, if we query the battle_ships table:\nr.db('ships').table('battle_ships') We will see the following JSON has been entered into the database:\n{ \"guns\": [ \"railgun\" , \"off_shore_missles\" ] , \"id\": \"35502dbd-0354-4ca8-bef5-06825ab8df26\" , \"name\": \"Arizona\" , \"size\": 22 } { \"guns\": [ \"light_machine\" ] , \"id\": \"b960127b-994f-44b7-88f5-f7463fc90dae\" , \"name\": \"Iowa\" , \"size\": 34 } Getting data // Get all battle ships r.db('ships').table('battle_ships') .run(connection, function(err, cursor) { if (err) throw err; cursor.toArray(function(err, res) { if (err) throw err; console.log(JSON.stringify(res)); }); }); In this example, we are getting all the ships in the battle_ships table. Most rethink queries of this size will return a cursor by default, so to get the raw results, we must make it an array with the .toArray method. The callback will contain the results that can than be parsed further.\n// Get specific battleship r.db('ships').table('battle_ships') .get('35502dbd-0354-4ca8-bef5-06825ab8df26') .run(connection, function(err, res) { if (err) throw err; console.log(JSON.stringify(res)); }); This gets a single ship from the battle_ships table based on the primary key. The primary key is the ID automatically assigned to the inserted JSON. The results we get back in the callback function is the JSON object of the provided key.\nUpdate JSON objects // Update the length of The Texas battle ship r.db('ships').table('cruisers').filter(r.row(\"name\").eq(\"Texas\")) .update({ \"length\": 33 }).run(connection, function(err, res) { if (err) throw err; console.log(JSON.stringify(res)); }); Here, we update a ship’s length by providing an updated JSON object. Note that we don’t need to provide all fields of the object in order for it to be updated. Once we run the query, the returned result will be what was updated in the database. This snippet also introduces the .filter rethink method. This can be used to pull specific records based on a number of conditions. Finding json objects this way is very powerful and can be chained with other queries. Almost anything you can do with SQL or Mongo, you can do with rethink queries. Check out this awesome page for some really useful queries.\nDelete JSON data // Remove the Iowa battle ship r.db('ships').table('battle_ships') .filter(r.row('name').eq('Iowa')) .delete() .run(connection, function(err, res) { if (err) throw err; console.log(JSON.stringify(res)); }); Here, we again use the .filter method to find a document in the database. Then, we delete it using the .delete() rethink method. After running this query, the JSON will be removed from the database.\nConclusion I hope that this little dive into RethinkDB has been interesting and has you curious about JSON based databases. Being able to store raw JSON in a NoSQL database is extremely powerful and fits well with JavaScript based architectures.\nIf you found this blog post valuable, consider subscribing to future posts via RSS or buying me a coffee via GitHub sponsors.\n","wordCount":"1198","inLanguage":"en","datePublished":"2018-11-05T21:15:35-07:00","dateModified":"2018-11-05T21:15:35-07:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://johncodes.com/posts/legacy/rethink-db-cookbook/"},"publisher":{"@type":"Organization","name":"John McBride","logo":{"@type":"ImageObject","url":"https://johncodes.com/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://johncodes.com/ accesskey=h title="John McBride (Alt + H)">John McBride</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://johncodes.com/archives title=Writing><span>Writing</span></a></li><li><a href=https://johncodes.com/index.xml title=RSS><span>RSS</span></a></li><li><a href=https://johncodes.com/talks/ title=Talks><span>Talks</span></a></li><li><a href=https://johncodes.com/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://johncodes.com/about title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Rethink-DB Cookbook</h1><div class=post-meta><span title='2018-11-05 21:15:35 -0700 -0700'>November 5, 2018</span></div></header><div class=post-content><p>(Note: this is from an old blog archieve dating 2018/11/05. Some things with Rethink have very likely changed)
RethinkDB is a JSON based, non-relational database that provides a promise oriented, Node JS backend. It integrates seamlessly with JSON type data and is a production ready option for Node infrastructures.</p><p>Pre-reqs: Docker, Node, NPM</p><p>This post will serve as a brief overview of RethinkDB and hopefully give you a taste of how it works and why a JSON based database might be beneficial for you and your product. You should have some knowledge of docker for this tutorial, but it&rsquo;s not required. However, knowledge of Node and JavaScript will be necessary.</p><h1 id=run-the-offical-docker-image>Run the offical Docker Image<a hidden class=anchor aria-hidden=true href=#run-the-offical-docker-image>#</a></h1><p>You can pull and run the <a href=https://hub.docker.com/_/rethinkdb/>official</a> rethink docker image to start the database locally. Simply give it a name and you&rsquo;re on your way!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run -d -P --name &lt;your container name&gt; rethinkdb
</span></span></code></pre></div><p>To check the port mappings in docker, simply run</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker port &lt;your container name&gt;
</span></span></code></pre></div><p>This will show you something like this:</p><pre tabindex=0><code>28015/tcp -&gt; 0.0.0.0:32769
29015/tcp -&gt; 0.0.0.0:32768
8080/tcp -&gt; 0.0.0.0:32770
</code></pre><p>Each of the local port mappings appear on the right and the docker container exposed ports are on the left.</p><p>So, if you wanted to access the containers 8080 port, we would navigate to <code>localhost:32770</code>. We can see this from the example as <code>8080/tcp -> 0.0.0.0:32770</code>.</p><p>Alternatively, you can install rethinkdb for your specific machine and run it locally. This can be found on the <a href=https://rethinkdb.com/docs/install/>RethinkDB install page</a>. Using the docker container & image is a nice, light weight, modular way to run rethink, similar to how a production microservice architecture might be configured. I also like being able to control the exact environment that my rethink database is running in, it&rsquo;s ports, and other fun docker quality of life things!</p><h1 id=using-the-rethinkdb-admin-pannel>Using the RethinkDB admin pannel<a hidden class=anchor aria-hidden=true href=#using-the-rethinkdb-admin-pannel>#</a></h1><p>If using the docker container, navigate to the Admin Panel by going to <code>localhost:32770</code> in a browser. From our previous example, we can see that this local port is mapped to the docker container port 8080 (which is the web admin panel). If you&rsquo;re running rethink on your machine locally, you should be able to simply navigate to <code>localhost:8080</code>.</p><p>In the admin pannel, you create new databases, explor data, see logs, track performance, and see what connections are running. Lets create a database with a few tables.</p><p>In the top navigation bar, go to the &ldquo;Data Explorer&rdquo; and enter the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>dbCreate</span>(<span style=color:#e6db74>&#39;ships&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>db</span>(<span style=color:#e6db74>&#39;ships&#39;</span>).<span style=color:#a6e22e>tableCreate</span>(<span style=color:#e6db74>&#39;battle_ships&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>db</span>(<span style=color:#e6db74>&#39;ships&#39;</span>).<span style=color:#a6e22e>tableCreate</span>(<span style=color:#e6db74>&#39;cruisers&#39;</span>)
</span></span></code></pre></div><p>These raw rethink queries create and build our initial database. This can also be acomplished from &ldquo;Tables&rdquo; in the top navigation bar or right in your node app! However, the &ldquo;Data Explorer&rdquo; is an essential tool for viewing, manuipulating, and creating data. This is a great <a href=https://rethinkdb.com/docs/reql-data-exploration/>link</a> for useful Data Explorer queries.</p><h1 id=install-rethink-javascript-drivers-via-npm>Install Rethink javascript drivers via NPM<a hidden class=anchor aria-hidden=true href=#install-rethink-javascript-drivers-via-npm>#</a></h1><p>In order to use the rethink drivers in our Node app, we need to install them via NPM. From the command line:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>npm</span> <span style=color:#a6e22e>install</span> <span style=color:#a6e22e>rethinkdb</span>
</span></span></code></pre></div><p>The <code>node_modules</code> folder will now contain the necessary rethink drivers for accessing our rethink instance. To access the rethink drivers from your Node app, require the drivers:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>r</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;rethinkdb&#39;</span>);
</span></span></code></pre></div><h1 id=open-a-connection-to-the-rethink-instance>Open a connection to the Rethink instance<a hidden class=anchor aria-hidden=true href=#open-a-connection-to-the-rethink-instance>#</a></h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>connection</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// This could also be declared from a .env file
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>config</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>host</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;localhost&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>port</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;32769&#39;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>connect</span>(<span style=color:#a6e22e>config</span>, <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>err</span>, <span style=color:#a6e22e>conn</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>err</span>) <span style=color:#66d9ef>throw</span> <span style=color:#a6e22e>err</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>connection</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>conn</span>;
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p>Now, the connection variable will hold the raw data necessary to connect to the rethink instance. Make special note of what port you specify. This should be the port that maps to 28015 in the docker container.</p><p>For this local instance of the rethinkdb, we won&rsquo;t worry too much about dynamic ports or not exposing the ports to the public in production. <a href=https://medium.com/@brucelim/creating-a-rest-api-with-rethinkdb-nodejs-express-81ed12f01e59>Here</a> is a good article about one way you can create production ready ports and configurations.</p><p>This step can be quite complicated. You can do a number of things per your needs, including placing this step into some middleware to connect automatically, check the configuration of your database, reconfigure settings if something is wrong, or validate authorization. Check out <a href=https://github.com/rethinkdb/rethinkdb-example-nodejs>this repository</a> from the rethink people for more complex operations around connecting.</p><h1 id=basic-crud-operations>Basic Crud Operations<a hidden class=anchor aria-hidden=true href=#basic-crud-operations>#</a></h1><h3 id=insert-data>Insert Data<a hidden class=anchor aria-hidden=true href=#insert-data>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// Inserts 2 battleships
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>db</span>(<span style=color:#e6db74>&#39;ships&#39;</span>).<span style=color:#a6e22e>table</span>(<span style=color:#e6db74>&#39;battle_ships&#39;</span>).<span style=color:#a6e22e>insert</span>([
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;name&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Arizona&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;size&#39;</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>22</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;guns&#39;</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#39;railgun&#39;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#39;off_shore_missles&#39;</span>
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>  }, {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;name&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Iowa&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;size&#39;</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>34</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;guns&#39;</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#39;light_machine&#39;</span>
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>}]).<span style=color:#a6e22e>run</span>(<span style=color:#a6e22e>connection</span>, <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>err</span>, <span style=color:#a6e22e>res</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>err</span>) <span style=color:#66d9ef>throw</span> <span style=color:#a6e22e>err</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>(<span style=color:#a6e22e>res</span>));
</span></span><span style=display:flex><span>})
</span></span></code></pre></div><p>We can see that we are inserting raw JSON objects! Awesome! Now, from the Data explorer, if we query the <code>battle_ships</code> table:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>db</span>(<span style=color:#e6db74>&#39;ships&#39;</span>).<span style=color:#a6e22e>table</span>(<span style=color:#e6db74>&#39;battle_ships&#39;</span>)
</span></span></code></pre></div><p>We will see the following JSON has been entered into the database:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;guns&#34;</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;railgun&#34;</span> ,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;off_shore_missles&#34;</span>
</span></span><span style=display:flex><span>    ] ,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;id&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;35502dbd-0354-4ca8-bef5-06825ab8df26&#34;</span> ,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;name&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;Arizona&#34;</span> ,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;size&#34;</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>22</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;guns&#34;</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;light_machine&#34;</span>
</span></span><span style=display:flex><span>    ] ,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;id&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;b960127b-994f-44b7-88f5-f7463fc90dae&#34;</span> ,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;name&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;Iowa&#34;</span> ,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;size&#34;</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>34</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=getting-data>Getting data<a hidden class=anchor aria-hidden=true href=#getting-data>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// Get all battle ships
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>db</span>(<span style=color:#e6db74>&#39;ships&#39;</span>).<span style=color:#a6e22e>table</span>(<span style=color:#e6db74>&#39;battle_ships&#39;</span>)
</span></span><span style=display:flex><span>  .<span style=color:#a6e22e>run</span>(<span style=color:#a6e22e>connection</span>, <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>err</span>, <span style=color:#a6e22e>cursor</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>err</span>) <span style=color:#66d9ef>throw</span> <span style=color:#a6e22e>err</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cursor</span>.<span style=color:#a6e22e>toArray</span>(<span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>err</span>, <span style=color:#a6e22e>res</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>err</span>) <span style=color:#66d9ef>throw</span> <span style=color:#a6e22e>err</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>(<span style=color:#a6e22e>res</span>));
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p>In this example, we are getting all the ships in the battle_ships table. Most rethink queries of this size will return a cursor by default, so to get the raw results, we must make it an array with the <code>.toArray</code> method. The callback will contain the results that can than be parsed further.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// Get specific battleship
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>db</span>(<span style=color:#e6db74>&#39;ships&#39;</span>).<span style=color:#a6e22e>table</span>(<span style=color:#e6db74>&#39;battle_ships&#39;</span>)
</span></span><span style=display:flex><span>  .<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;35502dbd-0354-4ca8-bef5-06825ab8df26&#39;</span>)
</span></span><span style=display:flex><span>  .<span style=color:#a6e22e>run</span>(<span style=color:#a6e22e>connection</span>, <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>err</span>, <span style=color:#a6e22e>res</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>err</span>) <span style=color:#66d9ef>throw</span> <span style=color:#a6e22e>err</span>;
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>(<span style=color:#a6e22e>res</span>));
</span></span><span style=display:flex><span>  });
</span></span></code></pre></div><p>This gets a single ship from the battle_ships table based on the primary key. The primary key is the ID automatically assigned to the inserted JSON. The results we get back in the callback function is the JSON object of the provided key.</p><h3 id=update-json-objects>Update JSON objects<a hidden class=anchor aria-hidden=true href=#update-json-objects>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// Update the length of The Texas battle ship
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>db</span>(<span style=color:#e6db74>&#39;ships&#39;</span>).<span style=color:#a6e22e>table</span>(<span style=color:#e6db74>&#39;cruisers&#39;</span>).<span style=color:#a6e22e>filter</span>(<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>row</span>(<span style=color:#e6db74>&#34;name&#34;</span>).<span style=color:#a6e22e>eq</span>(<span style=color:#e6db74>&#34;Texas&#34;</span>))
</span></span><span style=display:flex><span>  .<span style=color:#a6e22e>update</span>({
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;length&#34;</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>33</span>
</span></span><span style=display:flex><span>  }).<span style=color:#a6e22e>run</span>(<span style=color:#a6e22e>connection</span>, <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>err</span>, <span style=color:#a6e22e>res</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>err</span>) <span style=color:#66d9ef>throw</span> <span style=color:#a6e22e>err</span>;
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>(<span style=color:#a6e22e>res</span>));
</span></span><span style=display:flex><span>  });
</span></span></code></pre></div><p>Here, we update a ship&rsquo;s length by providing an updated JSON object. Note that we don&rsquo;t need to provide all fields of the object in order for it to be updated. Once we <code>run</code> the query, the returned result will be what was updated in the database. This snippet also introduces the <code>.filter</code> rethink method. This can be used to pull specific records based on a number of conditions. Finding json objects this way is very powerful and can be chained with other queries. Almost anything you can do with SQL or Mongo, you can do with rethink queries. Check out <a href=https://rethinkdb.com/docs/introduction-to-reql/>this awesome page</a> for some really useful queries.</p><h3 id=delete-json-data>Delete JSON data<a hidden class=anchor aria-hidden=true href=#delete-json-data>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// Remove the Iowa battle ship
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>db</span>(<span style=color:#e6db74>&#39;ships&#39;</span>).<span style=color:#a6e22e>table</span>(<span style=color:#e6db74>&#39;battle_ships&#39;</span>)
</span></span><span style=display:flex><span>  .<span style=color:#a6e22e>filter</span>(<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>row</span>(<span style=color:#e6db74>&#39;name&#39;</span>).<span style=color:#a6e22e>eq</span>(<span style=color:#e6db74>&#39;Iowa&#39;</span>))
</span></span><span style=display:flex><span>  .<span style=color:#66d9ef>delete</span>()
</span></span><span style=display:flex><span>  .<span style=color:#a6e22e>run</span>(<span style=color:#a6e22e>connection</span>, <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>err</span>, <span style=color:#a6e22e>res</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>err</span>) <span style=color:#66d9ef>throw</span> <span style=color:#a6e22e>err</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>(<span style=color:#a6e22e>res</span>));
</span></span><span style=display:flex><span>    });
</span></span></code></pre></div><p>Here, we again use the <code>.filter</code> method to find a document in the database. Then, we delete it using the <code>.delete()</code> rethink method. After running this query, the JSON will be removed from the database.</p><h1 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h1><p>I hope that this little dive into RethinkDB has been interesting and has you curious about JSON based databases. Being able to store raw JSON in a NoSQL database is extremely powerful and fits well with JavaScript based architectures.</p><hr><p>If you found this blog post valuable,
consider <a href=https://johncodes.com/index.xml>subscribing to future posts via RSS</a>
or <a href=https://github.com/sponsors/jpmcb>buying me a coffee via GitHub sponsors.</a></p><hr><script src=https://giscus.app/client.js data-repo=jpmcb/blog data-repo-id="MDEwOlJlcG9zaXRvcnkxMTYxODMyNjg=" data-category="Blog comments" data-category-id=DIC_kwDOBuzQ5M4CTbHW data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=dark_dimmed data-lang=en data-loading=lazy crossorigin=anonymous async></script></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://johncodes.com/>John McBride</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>